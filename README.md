# RRR 타임 세일 쿠폰 이커머스

![프로젝트 대표 이미지](./project-image.jpg)

**RRR**는 **대규모 트래픽 환경**에서도 안정적으로 작동하는 **쿠폰 발급 및 재고 관리 시스템**을 제공하는  
MSA 기반 **이커머스 프로젝트**입니다.

---

## 프로젝트 핵심 목표

1. **대규모 트래픽 대응**
   - Redis와 Kafka를 활용한 비동기 처리를 통해 API 요청 200req/sec 이상 처리.
   - 동시성 문제를 해결하며 안정적인 쿠폰 발급 서비스 제공.

2. **성능 최적화**
   - Redis 기반 캐싱으로 실시간 상품 조회 성능을 3배 향상.
   - Redisson을 사용하여 CPU 점유율 50% 감소 및 안정적 데이터 처리 구현.

3. **운영 및 배포 효율화**
   - Docker와 Github Actions를 이용한 CI/CD 파이프라인 구축으로 배포 자동화.
   - Prometheus와 Grafana를 활용한 실시간 모니터링으로 시스템 안정성 확보.

4. **데이터 일관성 및 트랜잭션 관리**
   - Kafka를 이용한 SAGA 패턴으로 분산 트랜잭션 관리.
   - 중복 및 데이터 손실을 방지하는 Kafka Batch Listener 구현.

---

## KEY Summary

### 🍁 **성능 개선: 최저가 상품 조회 성능 3배 이상 향상**

1. **한 줄 요약**  
   - Redis 도입으로 기존 DB 조회보다 **348% 성능 개선**  
   - 대규모 트래픽 환경에서도 안정적인 서비스 유지

2. **도입 배경**  
   - 실시간 최저가를 제공하기 위해 외부 서버의 할인율과 자체 할인율 비교 기능 구현 필요.

3. **기술적 선택지**  
   - **DB 데이터 적재:** 데이터베이스 부하 증가 우려.
   - **Redis 캐싱:** TTL 설정으로 타임세일 종료 시 자동 삭제.  

   **결론:** Redis 도입을 통해 실시간 성능 개선.

---

### 🍁 **트러블 슈팅: LazyConnectionDataSourceProxy로 커넥션 점유 문제 해결**

1. **문제**  
   - 트랜잭션 시작 시 불필요한 커넥션 점유 발생.

2. **해결 방안**  
   - **LazyConnectionDataSourceProxy**를 활용하여 실제 요청 시점에만 커넥션 할당.

---

## 인프라 아키텍처 & 적용 기술

### 아키텍처 다이어그램
![Infra Architecture](./architecture.png)

위 아키텍처는 **MSA 기반의 이커머스 서비스** 구조를 나타냅니다.  
Redis와 Kafka를 활용하여 안정적인 비동기 처리를 구현하고, Docker로 컨테이너화하여 CI/CD로 자동 배포됩니다.

<details>
<summary><b>📦 적용 기술 상세보기</b></summary>

### 💾 **데이터베이스 및 캐싱**
- **Redis**  
  - 실시간 캐싱 및 TTL 설정으로 데이터 최신성 유지.

### 📬 **메시징 시스템**
- **Kafka**  
  - 서비스 간 데이터 일관성 유지와 대용량 메시지 처리.

### 🌐 **운영 및 배포**
- **Docker**  
  - 서비스 컨테이너화를 통해 환경 이식성 확보.
- **Prometheus & Grafana**  
  - 실시간 모니터링으로 시스템 안정성 확보.

</details>

---

## 주요 기능

### 🍁 **쿠폰 발급: Redis 및 Kafka를 통한 비동기 처리**
- 대용량 트래픽에서도 안정적인 쿠폰 발급 시스템 구현.
- Redis Lua Script로 동시성 제어.

### 🍁 **주문 처리: Saga 패턴 적용**
- 독립적 트랜잭션 관리를 통해 오류 발생 시 자동 롤백.

### 🍁 **최저가 조회: Redis 캐싱 활용**
- 실시간 최저가 조회 성능 최적화.

---

## 역할 분담 및 협업 방식

### **Detail Role**

| 이름   | 포지션   | 담당(개인별 기여점)                                                                                                            | Github 링크                       |
|--------|----------|-----------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
| 김ㅇㅇ | 리더     | ▶ **결제**: 토스페이먼츠 PG 연동, 간편결제 구현<br>▶ **정산**: 스프링 배치 활용 (Jpa → Jdbc 변경하여 4.6배 개선)<br>▶ **배포**: 멀티모듈 설정, CI/CD 적용 | [🍁 깃헙링크](https://github.com/kim-user) |
| 조ㅇㅇ | 부리더   | ▶ **쿠폰**: Redis Lua Script 및 타임세일 Kafka 비동기 처리 구현                          | [🍁 깃헙링크](https://github.com/jo-user) |
| 박ㅇㅇ | 팀원     | ▶ **주문**: MSA 기반 주문 로직 및 자동 삭제 구현                                                | [🍁 깃헙링크](https://github.com/park-user) |
| 정ㅇㅇ | 팀원     | ▶ **유레카 & 게이트웨이**: CircuitBreaker 및 Retry 장애 대응 구축 | [🍁 깃헙링크](https://github.com/jung-user) |

---

## 성과 및 회고

### 잘된 점
- Redis와 Kafka를 통해 **트래픽 대응 능력 강화**.
- 효율적인 협업과 CI/CD로 개발-배포 주기 단축.

### 아쉬운 점
- 프로젝트 초기 설계 부족으로 일부 서비스 의존성 증가.

### 향후 계획
- Java 21의 가상 스레드 활용으로 병렬 처리 성능 개선.
- 사용자 피드백 시스템 추가로 서비스 품질 향상.
